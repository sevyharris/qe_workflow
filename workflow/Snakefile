# comment
import os

bulk_dir = "../results/bulk"
slab_dir = "../results/slab"
adsorbate_dir = "../results/adsorbate"

bulk_script = "scripts/relax_bulk.py"
slab_script = "scripts/relax_slab.py"
adsorbate_script = "scripts/relax_adsorbate.py"
run_bulk_script = "scripts/run_bulk.sh"
run_slab_script = "scripts/run_slab.sh"
run_adsorbate_script = "scripts/run_adsorbate.sh"


rule calc_bulk:
    # Rule to compute the bulk constant
    input:
        bulk_script
    output:
        "../results/bulk/bulk.pwo"
    conda:
        "envs/qe.yaml"
    shell:
        """
        mydir=$(pwd)
        mkdir -p {bulk_dir}
        cp {input} {bulk_dir}
        cp {run_bulk_script} {bulk_dir}
        cd {bulk_dir}
        sbatch run_bulk.sh
        cd $mydir
        """

rule relax_slab:
    input:
        rules.calc_bulk.output[0],
        slab_script
    output:
        "../results/slab/slab.pwo"
    conda:
        "envs/qe.yaml"
    shell:
        """
        mydir=$(pwd)
        mkdir -p {slab_dir}
        cp {rules.calc_bulk.output[0]} {slab_dir}
        cp {input[1]} {slab_dir}
        cp {run_slab_script} {slab_dir}
        cd {slab_dir}
        sbatch run_slab.sh
        cd $mydir
        """

adsorbate = "CO2"
adsorbate_xyz = os.path.join('..', 'resources', 'adsorbates', adsorbate + '.xyz')
one_ads_dir = os.path.join(adsorbate_dir, adsorbate)
rule relax_adsorbate:
    input:
        adsorbate_xyz
    shell:
        """
        mydir=$(pwd)
        mkdir -p {one_ads_dir}
        cp {adsorbate_xyz} {one_ads_dir}
        cp {adsorbate_script} {one_ads_dir}
        cp {run_ads_script} {one_ads_dir}
        cd {one_ads_dir}
        sbatch run_slab.sh
        cd $mydir
        """

rule relax_all_adsorbates:
    shell:
        "echo hello"


rule name_files:
    input:
        bulk_script
    run:
        print(input)
        print(rules.calc_bulk.output)


